# =============================================================================
# PostgreSQL Client Authentication Configuration
# =============================================================================
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Local connections (Unix socket) - trust for postgres superuser
local   all             postgres                                trust
local   all             all                                     scram-sha-256

# -----------------------------------------------------------------------------
# Replication connections - Certificate Authentication ONLY
# The CN in the client cert must match the username (replicator)
# -----------------------------------------------------------------------------
hostssl replication     replicator      0.0.0.0/0               cert
hostssl replication     replicator      ::/0                    cert

# -----------------------------------------------------------------------------
# Certificate-authenticated users (appuser uses cert auth)
# The CN in the client cert must match the username
# -----------------------------------------------------------------------------
hostssl all             appuser         0.0.0.0/0               cert
hostssl all             appuser         ::/0                    cert

# -----------------------------------------------------------------------------
# Password-authenticated users (any other user with password)
# Requires SSL but uses scram-sha-256 for password verification
# -----------------------------------------------------------------------------
hostssl all             all             0.0.0.0/0               scram-sha-256
hostssl all             all             ::/0                    scram-sha-256

# -----------------------------------------------------------------------------
# Deny non-SSL connections from network
# -----------------------------------------------------------------------------
host    all             all             0.0.0.0/0               reject
host    all             all             ::/0                    reject
